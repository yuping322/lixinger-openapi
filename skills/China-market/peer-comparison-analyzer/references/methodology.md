# 方法论：同行比较分析器（A股）

本技能用于**对比分析A股同行业公司的财务指标、估值和市场表现，识别相对优势和投资机会**。同行比较是基本面分析的核心方法。

## 数据口径

### 数据源与字段映射

同行比较分析需要以下数据：
- **财务数据**：AKShare (`stock_financial_report_sina`)
  - 营收、净利润、ROE、资产负债率
  - 季度/年度数据，财报发布后更新
- **估值数据**：AKShare (`stock_zh_a_hist`)
  - PE、PB、PS、市值
  - 日频数据，实时更新
- **行业数据**：AKShare (`stock_board_industry_name_em`)
  - 行业分类、同行业公司列表
  - 静态数据，定期更新
- **市场表现数据**：AKShare (`stock_zh_a_hist`)
  - 涨跌幅、换手率、成交额
  - 日频数据，实时更新

关键字段：
- `同行业公司`：相同行业分类的公司
- `相对指标 = 个股指标 / 行业平均指标`
- `排名 = rank(指标) within industry`

### 时间窗口与频率

- **季度数据**：财务数据（季报、年报）
- **日频数据**：估值、市场表现
- **对比周期**：与同行业公司对比

## 核心指标

### 指标列表与计算公式

1. **财务指标对比**：
   - `营收增速 = (营收 - 去年同期营收) / 去年同期营收 × 100%` (%)
   - `净利润增速 = (净利润 - 去年同期净利润) / 去年同期净利润 × 100%` (%)
   - `ROE = 归母净利润 / 净资产 × 100%` (%)
   - `资产负债率 = 总负债 / 总资产 × 100%` (%)

2. **估值指标对比**：
   - `PE = 总市值 / 归母净利润` (倍)
   - `PB = 总市值 / 净资产` (倍)
   - `PS = 总市值 / 营收` (倍)
   - `PEG = PE / 净利润增速` (倍)

3. **相对指标**：
   - `相对营收增速 = 营收增速 / 行业平均营收增速` (倍)
   - `相对ROE = ROE / 行业平均ROE` (倍)
   - `相对PE = PE / 行业平均PE` (倍)
   - `相对PB = PB / 行业平均PB` (倍)

4. **排名指标**：
   - `营收增速排名 = rank(营收增速) within industry` (排名)
   - `ROE排名 = rank(ROE) within industry` (排名)
   - `PE排名 = rank(PE) within industry` (排名)
   - `综合排名 = f(财务排名, 估值排名, 市场表现排名)` (排名)

5. **市场表现对比**：
   - `相对涨跌幅 = 涨跌幅 - 行业平均涨跌幅` (%)
   - `相对换手率 = 换手率 / 行业平均换手率` (倍)
   - `市场关注度 = 成交额排名 within industry` (排名)

### 标准化方法

- 使用**相对指标**评估相对优势
- 使用**行业排名**识别行业龙头
- 使用**综合评分**综合评估公司质量

## 信号与阈值

### 可测试规则（Insight Rules）

Rule 1 (高增长 + 低估值 → 相对优势):
IF {营收增速排名 <= 20% AND ROE排名 <= 30% AND 相对PE < 0.8}
THEN {未来6-12个月，跑赢行业概率 >= 65%，超额收益 >= 5%}
CONFIDENCE {0.65; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，同行业对比}
FAILURE_MODE {增长不可持续；行业整体下行；估值陷阱（盈利质量差）}

Rule 2 (龙头溢价 + 业绩稳定 → 防御配置):
IF {市值排名 = 1 AND ROE稳定性 >= 0.8 AND 资产负债率 < 50%}
THEN {未来12个月，波动率 <= 行业平均 - 5%，下跌保护}
CONFIDENCE {0.62; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，行业龙头}
FAILURE_MODE {龙头地位动摇；行业竞争加剧；业绩不及预期}

Rule 3 (估值折价 + 基本面改善 → 估值修复):
IF {相对PE < 0.7 AND 净利润增速转正 AND ROE提升 >= 2%}
THEN {未来3-6个月，估值修复，超额收益 >= 8%}
CONFIDENCE {0.60; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，估值折价股}
FAILURE_MODE {基本面改善不及预期；行业整体估值压缩；市场风格不利}

Rule 4 (高估值 + 增速放缓 → 估值压缩):
IF {相对PE > 1.5 AND 营收增速 < 行业平均 AND 净利润增速下降 >= 10%}
THEN {未来3-6个月，估值压缩，跑输行业 >= 10%}
CONFIDENCE {0.63; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，高估值股}
FAILURE_MODE {增速超预期回升；行业整体估值提升；市场风格有利（成长股）}

### 触发/解除/无效化条件

- **触发对比**：
  - 财报发布后
  - 估值出现明显折价或溢价（相对PE < 0.7或 > 1.5）
  - 基本面出现明显变化

- **解除对比**：
  - 相对优势消失
  - 估值回归合理
  - 基本面恶化

- **无效化**：
  - 公司退市或被收购
  - 行业分类调整
  - 财务数据重大调整

### 阈值选择依据

- **20%营收增速排名**：营收增速排名 <= 20%属于高增长
- **30% ROE排名**：ROE排名 <= 30%属于高盈利能力
- **0.8相对PE**：相对PE < 0.8属于估值折价
- **1.5相对PE**：相对PE > 1.5属于估值溢价
- **50%资产负债率**：资产负债率 < 50%属于财务稳健

## 边界条件与降级策略

### 数据缺失/异常值处理

- **数据缺失**：
  - 财务数据缺失：剔除该公司，标注"数据缺失"
  - 行业数据缺失：使用市场数据代替，标注"使用市场数据"

- **异常值处理**：
  - PE < 0（亏损）：使用PB或PS代替
  - ROE > 50%：检查是否一次性收益

### 降级策略

- **同行业公司少**（< 5家）：
  - 扩大行业范围
  - 降级标注："同行业公司少，对比可能不准确"

- **财务数据不可比**（会计准则不同）：
  - 调整财务数据
  - 降级标注："财务数据调整，可比性降低"

## A股特殊注意

### 1. 行业分类

- **行业分类标准**：申万行业、证监会行业
- **分类差异**：不同分类标准结果不同
- **需要统一标准**：使用统一的行业分类

### 2. 财务数据质量

- **财务数据质量差异**：不同公司财务数据质量差异大
- **需要调整**：剔除非经常性损益

### 3. 估值差异

- **估值差异大**：同行业公司估值差异大
- **需要分析原因**：分析估值差异原因（成长性、盈利质量）

### 4. 市值效应

- **大盘股估值低**：大盘股估值通常低于小盘股
- **需要控制市值**：对比时控制市值因素

### 5. 龙头溢价

- **龙头溢价明显**：行业龙头估值溢价明显
- **需要考虑龙头地位**：对比时考虑龙头地位

### 6. 周期性

- **周期行业波动大**：周期行业财务指标波动大
- **需要平滑处理**：使用多年平均或TTM

### 7. 成长性

- **成长股估值高**：成长股估值高于价值股
- **需要使用PEG**：成长股使用PEG对比

### 8. 盈利质量

- **盈利质量差异**：不同公司盈利质量差异大
- **需要分析现金流**：关注经营现金流

### 9. 政策影响

- **政策影响行业**：政策对不同公司影响不同
- **需要考虑政策**：对比时考虑政策因素

### 10. 数据滞后

- **财务数据滞后**：财务数据滞后1-3个月
- **需要使用预测**：使用盈利预测补充

## 回测说明（最小化）

- **回测设计**：
  - 构建同行业对比组合
  - 选择相对优势股票
  - 计算超额收益

- **性能指标**：
  - 超额收益
  - 胜率
  - 信息比率

- **证伪条件**：
  - 超额收益 < 0
  - 胜率 < 50%

## 使用示例

### 示例1：高增长低估值

**输入**：个股A，2024-03-15财报
**数据**：
- 营收增速排名：15%（行业前列）
- ROE排名：25%
- 相对PE：0.75
**输出**：
- 信号：高增长 + 低估值（相对优势）
- **结论**：相对同行有优势，未来6-12个月跑赢行业概率高

### 示例2：龙头防御

**输入**：个股B，行业龙头
**数据**：
- 市值排名：1（行业第一）
- ROE稳定性：0.85
- 资产负债率：45%
**输出**：
- 信号：龙头溢价 + 业绩稳定（防御配置）
- **结论**：行业龙头，财务稳健，适合防御配置

### 示例3：估值修复

**输入**：个股C，2024-05-10财报
**数据**：
- 相对PE：0.65
- 净利润增速：转正至+8%
- ROE提升：+3%
**输出**：
- 信号：估值折价 + 基本面改善（估值修复）
- **结论**：估值折价，基本面改善，估值修复机会

### 示例4：估值压缩

**输入**：个股D，2024-06-15财报
**数据**：
- 相对PE：1.6
- 营收增速：低于行业平均
- 净利润增速下降：-12%
**输出**：
- 信号：高估值 + 增速放缓（估值压缩）
- **结论**：估值偏高，增速放缓，估值压缩风险
