# 方法论：ETF配置器（A股）

本技能用于**构建A股ETF组合，实现低成本、分散化的资产配置**。ETF是被动投资的核心工具，适合长期配置和战术轮动。

## 数据口径

### 数据源与字段映射

ETF配置需要以下数据：
- **ETF基础数据**：AKShare (`fund_etf_spot_em`), 东方财富
  - ETF代码、名称、类型、跟踪指数
  - 规模、费率、折溢价率
  - 日频数据，实时更新
- **ETF行情数据**：AKShare (`fund_etf_hist_em`)
  - 净值、价格、成交量、换手率
  - 日频数据，实时更新
- **指数数据**：AKShare (`stock_zh_index_daily`)
  - 指数收益率、波动率、估值
  - 日频数据，实时更新
- **持仓数据**：AKShare (`fund_etf_fund_info_em`)
  - 前十大持仓、行业配置、风格暴露
  - 季度数据，季报发布后更新

关键字段：
- `跟踪误差 = std(ETF收益率 - 指数收益率)`
- `折溢价率 = (ETF价格 - ETF净值) / ETF净值`
- `流动性 = 日均成交额`
- `费率 = 管理费 + 托管费`

### 时间窗口与频率

- **日频数据**：ETF价格、净值、成交量
- **周频调仓**：战术配置每周调仓
- **月频调仓**：战略配置每月调仓
- **季度再平衡**：核心配置每季度再平衡

## 核心指标

### 指标列表与计算公式

1. **ETF质量指标**：
   - `规模 = ETF总资产` (亿元)
   - `费率 = 管理费 + 托管费` (%)
   - `跟踪误差 = std(ETF收益率 - 指数收益率) × √252` (%)
   - `折溢价率 = (ETF价格 - ETF净值) / ETF净值 × 100%` (%)

2. **流动性指标**：
   - `日均成交额 = mean(成交额, 20日)` (亿元)
   - `换手率 = 成交量 / 流通份额 × 100%` (%)
   - `买卖价差 = (卖一价 - 买一价) / 中间价 × 100%` (%)
   - `冲击成本 = 实际成交价 - 理论价格` (%)

3. **风险收益指标**：
   - `年化收益率 = (1 + 累计收益率)^(252/天数) - 1` (%)
   - `年化波动率 = std(日收益率) × √252` (%)
   - `夏普比率 = (年化收益率 - 无风险利率) / 年化波动率`
   - `最大回撤 = max(累计收益率峰值 - 当前累计收益率)` (%)

4. **配置指标**：
   - `权重 = ETF市值 / 组合总市值 × 100%` (%)
   - `风险贡献 = 权重 × β × 组合波动率` (%)
   - `相关性 = corr(ETF1收益率, ETF2收益率)`
   - `分散度 = 1 - Σ(权重^2)` (0-1)

5. **估值指标**：
   - `PE = 指数市盈率` (倍)
   - `PB = 指数市净率` (倍)
   - `股息率 = 指数股息率` (%)
   - `估值分位数 = rank(PE) / 历史天数` (%)

### 标准化方法

- 使用**夏普比率**评估风险调整后收益
- 使用**跟踪误差**评估ETF质量
- 使用**相关性矩阵**构建分散化组合
- 使用**风险平价**或**均值方差优化**确定权重

## 信号与阈值

### 可测试规则（Insight Rules）

Rule 1 (宽基ETF核心配置 → 长期稳健收益):
IF {ETF类型 = 沪深300/中证500/创业板指 AND 规模 >= 50亿 AND 费率 <= 0.6% AND 跟踪误差 <= 2%}
THEN {未来3-5年，年化收益率 >= 8%，夏普比率 >= 0.6}
CONFIDENCE {0.65; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股宽基ETF，适合长期配置}
FAILURE_MODE {市场长期熊市（系统性风险）；指数编制调整（跟踪误差增大）；ETF清盘（规模萎缩）}

Rule 2 (行业ETF轮动 → 超额收益):
IF {行业景气度上升 AND 行业估值 < 历史30%分位 AND 行业ETF规模 >= 10亿}
THEN {未来3-6个月，行业ETF跑赢宽基指数概率 >= 60%，超额收益 >= 5%}
CONFIDENCE {0.60; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股行业ETF，适合战术轮动}
FAILURE_MODE {行业景气度反转（周期下行）；政策不利（监管收紧）；市场风格转换（成长转价值）}

Rule 3 (折价ETF套利 → 低风险收益):
IF {折溢价率 <= -2% AND 规模 >= 20亿 AND 流动性好（日均成交额 >= 1亿）}
THEN {未来1-5个交易日，折价收敛概率 >= 70%，套利收益 >= 1.5%}
CONFIDENCE {0.70; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股ETF，流动性好的ETF套利机会}
FAILURE_MODE {市场剧烈波动（折价扩大）；ETF清盘风险（折价不收敛）；交易成本高（侵蚀收益）}

Rule 4 (低波动ETF防御 → 下跌保护):
IF {ETF类型 = 红利/低波/质量 AND 波动率 <= 市场波动率 × 0.8 AND 股息率 >= 3%}
THEN {市场下跌时，ETF跌幅 <= 市场跌幅 × 0.7，提供下跌保护}
CONFIDENCE {0.68; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股防御型ETF，适合熊市或震荡市}
FAILURE_MODE {市场风格转向成长（防御型跑输）；利率上升（高股息吸引力下降）；公司业绩下滑（分红不可持续）}

### 触发/解除/无效化条件

- **触发配置**：
  - 宽基ETF：规模 >= 50亿，费率 <= 0.6%，跟踪误差 <= 2%
  - 行业ETF：行业景气度上升，估值 < 30%分位
  - 折价ETF：折溢价率 <= -2%，流动性好
  - 防御ETF：市场下跌或震荡，波动率上升

- **解除配置**：
  - 宽基ETF：长期持有，不轻易调整
  - 行业ETF：行业景气度下降，估值 > 70%分位
  - 折价ETF：折价收敛，套利完成
  - 防御ETF：市场转牛，风格转向成长

- **无效化**：
  - ETF清盘或合并
  - ETF规模萎缩（< 5亿）
  - 跟踪误差过大（> 5%）
  - 市场异常波动（熔断、系统性风险）

### 阈值选择依据

- **50亿规模**：规模 >= 50亿的ETF流动性好，清盘风险低
- **0.6%费率**：费率 <= 0.6%属于低费率，长期持有成本低
- **2%跟踪误差**：跟踪误差 <= 2%说明ETF质量好，紧密跟踪指数
- **-2%折价**：折溢价率 <= -2%有套利空间
- **30%估值分位**：估值 < 30%分位属于低估，配置价值高

## 边界条件与降级策略

### 数据缺失/异常值处理

- **数据缺失**：
  - 净值数据缺失：使用价格数据代替，标注"使用价格数据"
  - 持仓数据缺失：使用上一季度数据，标注"数据滞后"
  - 指数数据缺失：使用ETF价格推算，标注"数据估算"

- **异常值处理**：
  - 折溢价率 > 10%或 < -10%：检查是否停牌或极端情况
  - 跟踪误差 > 10%：检查是否计算错误或ETF质量差
  - 换手率 > 500%：检查是否异常交易或数据错误

### 降级策略

- **持仓数据滞后**（> 3个月）：
  - 使用指数成分股代替
  - 无法精确评估风格暴露
  - 降级标注："持仓数据滞后，风格分析可能有偏"

- **流动性不足**（日均成交额 < 5000万）：
  - 降低配置权重
  - 增加交易成本估算
  - 降级标注："流动性不足，交易成本高"

- **跟踪误差过大**（> 3%）：
  - 使用指数基金代替
  - 降低配置权重
  - 降级标注："跟踪误差大，ETF质量差"

## A股特殊注意

### 1. T+1交易制度影响

- **ETF T+1交易**：ETF买入后次日才能卖出
- **无法日内套利**：无法在日内进行折溢价套利
- **需要隔夜风险**：T+1导致隔夜风险，影响套利策略

### 2. 涨跌停限制影响

- **ETF涨跌停**：ETF受涨跌停限制（±10%）
- **成分股涨跌停**：成分股涨跌停影响ETF净值
- **折溢价扩大**：涨跌停导致折溢价扩大
- **需要考虑流动性**：涨跌停时流动性下降

### 3. 停牌影响

- **成分股停牌**：成分股停牌影响ETF净值计算
- **ETF停牌**：ETF可能因成分股停牌而停牌
- **折溢价扩大**：停牌导致折溢价扩大
- **需要关注停牌**：停牌影响ETF交易和套利

### 4. 申赎机制

- **实物申赎**：ETF申赎需要一篮子股票
- **申赎门槛高**：最小申赎单位通常100万份
- **套利成本高**：申赎套利需要考虑冲击成本
- **需要专业投资者**：散户难以参与申赎套利

### 5. 费率差异

- **管理费**：0.15%-1.0%不等
- **托管费**：0.05%-0.25%不等
- **交易佣金**：与股票相同
- **需要关注费率**：费率影响长期收益

### 6. 跟踪误差

- **现金拖累**：ETF持有现金导致跟踪误差
- **成分股调整**：指数成分股调整导致跟踪误差
- **分红再投资**：分红再投资时机导致跟踪误差
- **需要选择优质ETF**：跟踪误差小的ETF质量好

### 7. 规模风险

- **小规模ETF**：规模 < 5亿的ETF清盘风险高
- **大规模ETF**：规模 > 100亿的ETF流动性好
- **需要关注规模**：规模影响ETF存续和流动性

### 8. 行业ETF特性

- **行业集中度高**：行业ETF集中度高，风险大
- **行业轮动快**：A股行业轮动快，需要及时调整
- **政策影响大**：行业ETF受政策影响大
- **需要动态调整**：行业ETF适合战术配置，不适合长期持有

### 9. 主题ETF风险

- **主题炒作**：主题ETF容易被炒作（如元宇宙、ChatGPT）
- **持续性差**：主题炒作持续性差，容易大幅回调
- **需要谨慎参与**：主题ETF风险高，不适合长期配置

### 10. 跨境ETF限制

- **QDII额度**：跨境ETF受QDII额度限制
- **申赎暂停**：QDII额度不足时申赎暂停
- **折溢价大**：跨境ETF折溢价波动大
- **需要关注额度**：QDII额度影响跨境ETF交易

## 回测说明（最小化）

- **回测设计**：
  - 构建ETF组合（宽基 + 行业轮动）
  - 每月调仓
  - 计算组合收益和风险

- **性能指标**：
  - 年化收益率
  - 夏普比率
  - 最大回撤
  - 相对基准超额收益

- **证伪条件**：
  - 夏普比率 < 基准（风险调整后收益差）
  - 最大回撤 > 基准 + 5%（风险控制差）

## 使用示例

### 示例1：宽基ETF核心配置

**输入**：构建长期配置组合
**数据**：
- 沪深300ETF：规模200亿，费率0.5%，跟踪误差1.5%
- 中证500ETF：规模150亿，费率0.6%，跟踪误差1.8%
- 创业板指ETF：规模100亿，费率0.5%，跟踪误差2.0%
**输出**：
- 配置方案：沪深300（50%）+ 中证500（30%）+ 创业板指（20%）
- **结论**：宽基ETF核心配置，长期稳健收益，夏普比率 >= 0.6

### 示例2：行业ETF轮动

**输入**：2024-03-15行业配置
**数据**：
- 新能源ETF：行业景气度上升，估值25%分位，规模30亿
- 医药ETF：行业景气度下降，估值80%分位，规模50亿
- 消费ETF：行业景气度平稳，估值50%分位，规模40亿
**输出**：
- 配置方案：增配新能源ETF，减配医药ETF，持有消费ETF
- **结论**：行业轮动策略，未来3-6个月新能源ETF跑赢概率高

### 示例3：折价ETF套利

**输入**：2024-04-20 ETF折溢价情况
**数据**：
- 某行业ETF：折溢价率-2.5%，规模25亿，日均成交额1.5亿
- 市场情绪：震荡市，流动性正常
**输出**：
- 套利策略：买入折价ETF，等待折价收敛
- **结论**：折价套利机会，预期1-5个交易日收益 >= 1.5%

### 示例4：防御型ETF配置

**输入**：2024-05-10市场下跌
**数据**：
- 红利ETF：波动率15%（市场20%），股息率4.5%
- 市场情绪：下跌趋势，风险偏好下降
**输出**：
- 配置方案：增配红利ETF，降低组合波动率
- **结论**：防御型ETF提供下跌保护，跌幅 <= 市场 × 0.7
