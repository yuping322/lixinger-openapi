# 方法论：市场广度监控（A股）

本技能用于**监控A股市场的广度指标，评估市场参与度和内在强度**。市场广度反映了市场上涨或下跌的普遍性，是判断市场健康度的重要指标。

## 数据口径

### 数据源与字段映射

市场广度监控需要以下数据：
- **个股行情数据**：AKShare (`stock_zh_a_spot_em`)
  - 涨跌幅、成交量、换手率
  - 日频数据，实时更新
- **指数数据**：AKShare (`stock_zh_index_daily`)
  - 指数涨跌幅、成交额
  - 日频数据，实时更新
- **涨跌停数据**：AKShare (`stock_zt_pool_em`, `stock_dt_pool_em`)
  - 涨停股数量、跌停股数量
  - 日频数据，实时更新
- **新高新低数据**：AKShare (`stock_zh_a_hist`)
  - 创52周新高股数、创52周新低股数
  - 日频数据，实时更新

关键字段：
- `上涨股数`：当日上涨股票数量
- `下跌股数`：当日下跌股票数量
- `涨停股数`：当日涨停股票数量
- `跌停股数`：当日跌停股票数量

### 时间窗口与频率

- **日频数据**：每日收盘后更新
- **周频汇总**：每周汇总广度指标
- **月频汇总**：每月汇总广度指标
- **历史对比**：与历史分位数对比

## 核心指标

### 指标列表与计算公式

1. **涨跌家数指标**：
   - `上涨家数比 = 上涨股数 / 总股数 × 100%` (%)
   - `下跌家数比 = 下跌股数 / 总股数 × 100%` (%)
   - `涨跌比 = 上涨股数 / 下跌股数` (倍)
   - `腾落指标 ADL = Σ(上涨股数 - 下跌股数)` (累计)

2. **涨跌停指标**：
   - `涨停股数` (只)
   - `跌停股数` (只)
   - `涨停比 = 涨停股数 / 总股数 × 100%` (%)
   - `跌停比 = 跌停股数 / 总股数 × 100%` (%)

3. **新高新低指标**：
   - `新高股数 = 创52周新高股数` (只)
   - `新低股数 = 创52周新低股数` (只)
   - `新高比 = 新高股数 / 总股数 × 100%` (%)
   - `新低比 = 新低股数 / 总股数 × 100%` (%)

4. **成交量广度指标**：
   - `放量股数 = 成交量 > 5日均量的股数` (只)
   - `缩量股数 = 成交量 < 5日均量的股数` (只)
   - `放量比 = 放量股数 / 总股数 × 100%` (%)
   - `成交额集中度 = 前10%股票成交额 / 总成交额` (%)

5. **背离指标**：
   - `指数涨跌幅` (%)
   - `上涨家数比` (%)
   - `背离度 = |指数涨跌幅 - (上涨家数比 - 50%) × 2|` (%)
   - `背离信号 = 1{背离度 >= 5%}` (0/1)

### 标准化方法

- 使用**历史分位数**评估广度指标强弱
- 使用**移动平均**平滑短期波动
- 使用**背离度**识别指数与个股分化
- 使用**腾落指标**累计市场广度变化

## 信号与阈值

### 可测试规则（Insight Rules）

Rule 1 (高广度 + 指数上涨 → 健康牛市):
IF {上涨家数比 >= 70% AND 指数涨幅 >= 1% AND 涨停股数 >= 50只}
THEN {未来5-10个交易日，指数继续上涨概率 >= 68%，市场健康}
CONFIDENCE {0.68; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股市场，全市场广度指标}
FAILURE_MODE {市场情绪过热（短期回调）；政策收紧（系统性风险）；外部冲击（地缘政治）}

Rule 2 (低广度 + 指数上涨 → 背离警示):
IF {上涨家数比 <= 30% AND 指数涨幅 >= 1% AND 背离度 >= 5%}
THEN {未来3-5个交易日，指数回调概率 >= 62%，警惕背离}
CONFIDENCE {0.62; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股市场，指数与个股背离}
FAILURE_MODE {权重股持续上涨（指数继续涨）；市场风格极端分化；政策利好（扭转背离）}

Rule 3 (新高股数扩散 → 趋势延续):
IF {新高股数 >= 100只 AND 新高股数增长 >= 20%（较上周）AND 新低股数 < 20只}
THEN {未来2-4周，市场趋势延续概率 >= 65%}
CONFIDENCE {0.65; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股市场，趋势行情}
FAILURE_MODE {新高股集中在少数板块（板块轮动）；市场情绪逆转（获利回吐）；外部冲击}

Rule 4 (跌停股数激增 → 恐慌性下跌):
IF {跌停股数 >= 100只 AND 跌停比 >= 3% AND 下跌家数比 >= 80%}
THEN {未来1-3个交易日，市场恐慌性下跌，但可能出现反弹}
CONFIDENCE {0.60; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股市场，极端下跌}
FAILURE_MODE {政策救市（快速反弹）；市场自发企稳；外部环境改善}

### 触发/解除/无效化条件

- **触发监控**：
  - 上涨家数比 >= 70%或 <= 30%（极端广度）
  - 背离度 >= 5%（指数与个股背离）
  - 涨停股数 >= 50只或跌停股数 >= 100只
  - 新高股数 >= 100只或新低股数 >= 100只

- **解除监控**：
  - 广度指标回归正常（上涨家数比40-60%）
  - 背离消失（背离度 < 3%）
  - 涨跌停股数回落

- **无效化**：
  - 市场停牌或熔断
  - 数据异常（如系统故障）
  - 市场制度变化（如涨跌停规则调整）

### 阈值选择依据

- **70%上涨家数比**：上涨家数比 >= 70%说明市场广度好，普涨行情
- **30%上涨家数比**：上涨家数比 <= 30%说明市场广度差，普跌行情
- **5%背离度**：背离度 >= 5%说明指数与个股明显背离
- **50只涨停股**：涨停股数 >= 50只说明市场情绪高涨
- **100只新高股**：新高股数 >= 100只说明趋势强劲

## 边界条件与降级策略

### 数据缺失/异常值处理

- **数据缺失**：
  - 个股数据缺失：剔除缺失数据的股票，标注"数据不完整"
  - 涨跌停数据缺失：使用涨跌幅 >= 9.9%估算，标注"数据估算"
  - 新高新低数据缺失：使用历史数据计算，标注"数据滞后"

- **异常值处理**：
  - 上涨家数比 > 95%或 < 5%：检查是否市场异常或数据错误
  - 涨停股数 > 500只：检查是否系统性利好或数据错误
  - 背离度 > 20%：检查是否极端行情或计算错误

### 降级策略

- **数据不完整**（缺失股票 > 10%）：
  - 使用可用数据计算
  - 标注"数据覆盖率XX%"
  - 降级标注："数据不完整，结论可能有偏"

- **市场异常**（停牌股 > 20%）：
  - 剔除停牌股计算
  - 标注"剔除停牌股"
  - 降级标注："停牌股多，广度指标失真"

- **极端行情**（涨跌停股 > 30%）：
  - 使用涨跌停前数据
  - 标注"极端行情"
  - 降级标注："极端行情，广度指标参考性降低"

## A股特殊注意

### 1. T+1交易制度影响

- **无法日内调整**：T+1限制导致无法根据广度指标日内调整
- **次日开盘风险**：广度恶化后次日开盘可能低开
- **需要提前判断**：需要盘中关注广度变化，提前判断

### 2. 涨跌停限制影响

- **涨跌停扭曲广度**：涨跌停股票无法正常交易，影响广度指标
- **连续涨跌停**：连续涨跌停导致广度指标持续失真
- **需要剔除涨跌停**：计算广度时可考虑剔除涨跌停股票

### 3. 停牌影响

- **停牌股不参与**：停牌股票不参与涨跌，影响广度计算
- **停牌股多时失真**：停牌股多时广度指标失真
- **需要调整分母**：计算广度时分母应剔除停牌股

### 4. 板块轮动

- **A股板块轮动快**：A股板块轮动快，广度指标波动大
- **结构性行情**：结构性行情时广度指标可能较低
- **需要分板块分析**：除全市场广度外，需分析板块广度

### 5. 权重股影响

- **权重股主导指数**：权重股涨跌主导指数，可能与广度背离
- **背离常见**：A股指数与个股背离较常见
- **需要关注背离**：背离是重要的市场信号

### 6. 散户行为

- **散户追涨杀跌**：散户追涨杀跌导致广度指标波动大
- **情绪化交易**：散户情绪化交易导致广度指标极端化
- **需要平滑处理**：使用移动平均平滑短期波动

### 7. 政策影响

- **政策市特征**：A股政策市特征明显，政策影响广度
- **政策利好扩散**：政策利好时广度快速扩散
- **政策收紧收缩**：政策收紧时广度快速收缩

### 8. 新股影响

- **新股上市影响**：新股上市首日涨停，影响涨停股数
- **需要剔除新股**：计算广度时可考虑剔除新股
- **新股破发影响**：新股破发多时影响市场情绪和广度

### 9. 市值效应

- **小盘股波动大**：小盘股涨跌幅大，影响广度指标
- **大盘股稳定**：大盘股涨跌幅小，广度指标相对稳定
- **需要分市值分析**：分析不同市值股票的广度

### 10. 数据更新时间

- **盘中数据实时**：盘中可实时监控广度变化
- **收盘数据准确**：收盘后数据最准确
- **需要盘中监控**：盘中监控广度变化，及时调整策略

## 回测说明（最小化）

- **回测设计**：
  - 计算历史广度指标
  - 识别极端广度信号
  - 统计信号后市场表现

- **性能指标**：
  - 信号准确率
  - 信号后平均涨跌幅
  - 信号持续时间

- **证伪条件**：
  - 信号准确率 < 55%（不优于随机）
  - 信号后收益不显著

## 使用示例

### 示例1：健康牛市

**输入**：2024-03-15市场数据
**数据**：
- 上涨家数比：75%
- 指数涨幅：+2.1%
- 涨停股数：68只
- 背离度：1.2%
**输出**：
- 信号：高广度 + 指数上涨（健康牛市）
- **结论**：市场广度好，普涨行情，未来5-10天继续上涨概率高

### 示例2：背离警示

**输入**：2024-04-20市场数据
**数据**：
- 上涨家数比：28%
- 指数涨幅：+1.5%
- 背离度：6.8%
- 权重股涨幅：+3.2%
**输出**：
- 信号：低广度 + 指数上涨（背离警示）
- **结论**：指数与个股背离，权重股拉抬指数，警惕回调

### 示例3：趋势延续

**输入**：2024-05-10市场数据
**数据**：
- 新高股数：125只（上周95只）
- 新高股数增长：+32%
- 新低股数：15只
- 指数涨幅：+1.8%
**输出**：
- 信号：新高股数扩散（趋势延续）
- **结论**：新高股数扩散，趋势强劲，未来2-4周趋势延续

### 示例4：恐慌性下跌

**输入**：2024-06-15市场数据
**数据**：
- 跌停股数：135只
- 跌停比：3.5%
- 下跌家数比：85%
- 指数跌幅：-3.8%
**输出**：
- 信号：跌停股数激增（恐慌性下跌）
- **结论**：市场恐慌性下跌，但跌停股多可能出现技术性反弹
