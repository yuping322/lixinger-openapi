# 方法论：沪深港通持仓监控（A股）

本技能用于**监控沪深港通（北向资金）的个股持仓变化、行业配置、重仓股动向**。沪深港通持仓数据反映外资的中长期配置偏好，持仓变化往往领先市场，是重要的配置参考。

## 数据口径

### 数据源与字段映射

沪深港通持仓监控需要以下数据：
- **个股持仓**：AKShare (`stock_hsgt_hold_stock_em`), 港交所
  - 持股数量、持股市值、持股占比（占流通股）、持股变化
  - 日频数据，T日晚间更新
- **十大持仓**：AKShare (`stock_hsgt_top10_em`), 东方财富
  - 北向资金持股市值Top10个股
  - 日频数据，T日晚间更新
- **行业持仓**：根据个股持仓聚合，使用申万一级/二级行业分类
- **历史持仓**：AKShare (`stock_hsgt_hist_em`)
  - 历史持仓数据，用于计算持仓变化趋势
  - 日频数据，可回溯至2014年

关键字段：
- `持股数量`：北向资金持有的股票数量（万股）
- `持股市值`：持股数量 × 当前股价（亿元）
- `持股占比`：持股数量 / 流通股本 (%)
- `持股变化`：当日持股数量变化（万股）
- `持股变化率`：持股变化 / 前日持股 (%)
- `连续增持天数`：连续持股增加的交易日数

### 时间窗口与频率

- **日频监控**：每日收盘后更新，T日晚间可获取T日数据
- **周频总结**：每周汇总持仓变化、行业配置调整、重仓股动向
- **月频趋势**：每月分析持仓趋势、配置变化、新进/退出个股

建议窗口：
- 短期变化：5日、10日持股变化
- 中期趋势：20日、60日持股变化
- 长期配置：120日、252日持股变化
- 持仓集中度：Top10、Top20、Top50持股占比

## 核心指标

### 指标列表与计算公式

1. **持仓规模指标**：
   - `持股市值 = 持股数量 × 当前股价`
   - `持股占比 = 持股数量 / 流通股本` (%)
   - `持股市值占比 = 个股持股市值 / 北向总持股市值` (%)
   - `持仓集中度 = Top10持股市值 / 北向总持股市值` (%)

2. **持仓变化指标**：
   - `持股变化 = 当日持股 - 前日持股`（万股）
   - `持股变化率 = 持股变化 / 前日持股` (%)
   - `N日累计变化 = Σ(持股变化)` over N days
   - `连续增持天数 = 连续持股增加的交易日数`

3. **行业配置指标**：
   - `行业持股市值 = Σ(行业内个股持股市值)`
   - `行业持股占比 = 行业持股市值 / 北向总持股市值` (%)
   - `行业超配度 = 行业持股占比 - 行业市值占比`（百分点）
   - `行业配置变化 = 当前行业占比 - 上期行业占比`（百分点）

4. **重仓股指标**：
   - `重仓股标志 = 1{持股占比 >= 5%}`
   - `重仓股数量 = count(持股占比 >= 5%)`
   - `重仓股持股变化 = 重仓股的持股变化率`
   - `新进重仓 = 1{持股占比从 < 5% 升至 >= 5%}`

5. **持仓强度指标**：
   - `持仓强度 = 持股市值 / 个股流通市值` (%)
   - `持仓强度百分位 = percentile_rank(持仓强度, 全市场)`
   - `持仓强度变化 = 当前持仓强度 - 上期持仓强度`（百分点）

### 标准化方法

- 使用**百分位排名**对持仓强度进行标准化（相对全市场）
- 使用**行业相对**计算超配/低配（行业持股占比 - 行业市值占比）
- 使用**移动平均**平滑短期波动（5日MA、20日MA）
- 使用**z-score**检测极端持仓变化（> 2倍标准差）

## 信号与阈值

### 可测试规则（Insight Rules）

Rule 1 (连续增持 + 持股占比上升 → 看好信号):
IF {连续增持天数 >= 5 AND 10日持股变化率 >= 10% AND 持股占比 >= 3%}
THEN {未来10-20个交易日，个股上涨概率 >= 65%，预期涨幅 >= 5%}
CONFIDENCE {0.65; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，流动性好的股票（日成交额 >= 5000万）信号更强}
FAILURE_MODE {股价已大幅上涨（追高风险）；基本面恶化（业绩暴雷）；市场整体转弱（系统性风险）；增持是被动配置（指数调整）}

Rule 2 (新进重仓 → 配置信号):
IF {持股占比从 < 5% 升至 >= 5% AND 20日持股变化率 >= 50%}
THEN {未来20-40个交易日，个股上涨概率 >= 62%，预期涨幅 >= 8%}
CONFIDENCE {0.62; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，外资可配置的股票（非限制行业）}
FAILURE_MODE {新进重仓是被动配置（指数纳入）；股价已提前上涨；基本面转差；外资持股接近上限（28%）}

Rule 3 (行业超配度上升 → 行业轮动):
IF {行业超配度 >= 3百分点 AND 行业配置变化 >= 1百分点/月 AND 行业持股占比 >= 10%}
THEN {未来20-40个交易日，该行业相对市场超额收益 >= 3%}
CONFIDENCE {0.60; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {申万一级行业，外资偏好行业（消费、医药、金融）信号更强}
FAILURE_MODE {行业已大幅上涨（追高）；行业基本面转差；超配是被动配置（指数调整）；市场整体转弱}

Rule 4 (连续减持 + 持股占比下降 → 谨慎信号):
IF {连续减持天数 >= 5 AND 10日持股变化率 <= -10% AND 持股占比从 >= 5% 降至 < 5%}
THEN {未来10-20个交易日，个股面临调整压力，预期下跌 >= 3%}
CONFIDENCE {0.63; 初步估计；需要历史验证}
APPLICABLE_UNIVERSE {A股个股，外资重仓股}
FAILURE_MODE {减持是获利了结（健康调整）；国内资金接盘；基本面改善（外资误判）；市场整体向好}

### 触发/解除/无效化条件

- **触发监控**：
  - 连续增持/减持 >= 5天
  - 10日持股变化率 >= 10%或 <= -10%
  - 持股占比跨越5%阈值（新进/退出重仓）
  - 行业超配度 >= 3百分点

- **解除监控**：
  - 持股变化恢复正常（-2% ~ +2%区间持续5天）
  - 持股占比稳定（变化 < 0.5百分点持续5天）
  - 行业超配度回落（< 2百分点）

- **无效化**：
  - 数据缺失或延迟 > 2天（节假日除外）
  - 个股停牌（无法交易）
  - 沪深港通暂停交易（台风、系统故障）
  - 外资持股接近上限（28%，无法继续增持）

### 阈值选择依据

- **5天连续增持**：连续5天增持表明趋势性配置，非短期波动
- **10%持股变化率**：10日持股变化10%以上，是显著配置调整
- **5%持股占比**：外资持股5%以上视为重仓股，是重要配置标志
- **3百分点超配度**：行业超配3百分点以上，表明明显的行业偏好
- **10%行业持股占比**：行业持股占比10%以上，是重要配置行业

## 边界条件与降级策略

### 数据缺失/异常值处理

- **数据缺失**：
  - 节假日：使用前一交易日数据，标注"节假日无数据"
  - 系统故障：使用港交所官网数据作为备份，标注"备用数据源"
  - 个股停牌：持仓数据保持不变，标注"停牌期间持仓不变"

- **异常值处理**：
  - 单日持股变化率 > 50%：检查是否数据错误或重大事件，标注"极端变化"
  - 持股占比 > 30%：检查是否接近外资持股上限，标注"接近上限"
  - 持股市值突变：检查是否股价异常波动或股本变化，标注"数据异常"

### 降级策略

- **AKShare接口不稳定**：
  - 备用数据源1：港交所官网数据（`www.hkexnews.hk`）
  - 备用数据源2：Wind API（需付费）
  - 备用数据源3：东方财富网页爬取
  - 降级标注："使用备用数据源，可能有延迟"

- **个股持仓数据缺失**：
  - 使用Top10持仓数据代替全量持仓
  - 使用行业聚合数据代替个股分析
  - 降级标注："个股数据不全，仅提供Top10分析"

- **历史数据不足**（< 252天）：
  - 使用可用历史计算趋势（标注样本期）
  - 使用固定阈值代替历史百分位
  - 降级标注："历史数据不足，趋势可能不准确"

## A股特殊注意

### 1. T+1交易制度影响

- **当日买入次日才能卖出**：外资当日增持后次日才能卖出，因此：
  - 连续增持比单日增持更有持续性
  - 增持后短期抛压较小（锁定效应）
  - 减持时可能集中在开盘（T日决策T+1日执行）

### 2. 涨跌停限制影响

- **涨停板限制买入**：个股涨停时外资无法买入，导致：
  - 增持可能延后到次日（涨停打开后）
  - 涨停股的持仓变化滞后于实际意图
  - 需要关注涨停打开后的持仓变化

- **跌停板限制卖出**：个股跌停时外资无法卖出，导致：
  - 减持可能延后到次日（跌停打开后）
  - 被动持仓增加（想卖卖不出）
  - 次日开盘可能集中抛售

### 3. 停牌影响

- **重大事项停牌**：个股停牌期间外资无法交易，导致：
  - 持仓被动锁定（无法调整）
  - 复牌后可能集中买入/卖出
  - 停牌期间持仓数据保持不变

### 4. 外资持股上限

- **单一外资上限10%**：单一外资持股不得超过10%
- **所有外资上限30%**：所有外资合计持股不得超过30%
- **接近上限时**：
  - 持股占比 > 28%：增持受限，可能触发强制卖出
  - 持股占比 = 30%：强制停止买入
  - 需要监控个股外资持股占比，避免误判

### 5. 行业限制

- **限制行业**：部分行业限制外资持股（如军工、传媒）：
  - 这些行业外资无法配置
  - 行业分析时需要剔除限制行业
  - 需要关注政策变化（行业开放/限制）

### 6. 指数调整影响

- **MSCI/富时罗素纳入**：指数调整时外资被动配置：
  - 纳入个股：被动增持（非主动看好）
  - 剔除个股：被动减持（非主动看空）
  - 权重调整：被动增持/减持
  - 需要区分主动配置和被动配置

### 7. 数据更新时间

- **T日晚间更新**：持仓数据在T日收盘后更新（通常19:00-20:00）：
  - 盘中无法获取实时持仓数据
  - 次日早盘前可获取前日完整数据
  - 日内分析需要使用北向资金流向数据推算

### 8. 汇率影响

- **人民币贬值**：外资持仓以人民币计价，汇率波动影响：
  - 人民币贬值时：持股市值下降（汇兑损失）
  - 人民币升值时：持股市值上升（汇兑收益）
  - 需要考虑汇率对持仓市值的影响

### 9. 港股通对比

- **港股通（南向资金）**：A股投资者买入港股，与沪深港通相反：
  - 南向增持 + 北向增持 = 两地互通加强
  - 南向减持 + 北向减持 = 两地互通减弱
  - 需要结合南向资金综合判断

### 10. 持仓披露规则

- **5%披露阈值**：外资持股达到5%需要披露：
  - 持股 >= 5%：视为重仓股，受到更多关注
  - 持股从 < 5% 升至 >= 5%：新进重仓，是重要信号
  - 持股从 >= 5% 降至 < 5%：退出重仓，是重要信号
  - 需要重点监控5%阈值附近的持仓变化

## 回测说明（最小化）

- **回测设计**：
  - 每日收盘后计算信号（T日晚间）
  - 次日开盘买入/卖出（T+1日）
  - 持有期：10日/20日/40日
  - 基准：个股前期走势、行业指数

- **性能指标**：
  - 信号胜率（信号后N日上涨概率）
  - 平均超额收益（信号后N日收益 - 基准收益）
  - 夏普比率、最大回撤

- **证伪条件**：
  - 信号胜率 <= 50%（不优于随机）
  - 平均超额收益 <= 0（不优于基准）
  - 夏普比率 <= 0.5（风险调整后收益不佳）

## 使用示例

### 示例1：连续增持

**输入**：个股A，2024-02-15收盘后
**数据**：
- 连续增持天数：7天
- 10日持股变化率：+15%
- 持股占比：4.2%（从3.5%上升）
- 持股市值：35亿
**输出**：
- 信号：连续增持 + 持股占比上升（看好信号）
- **结论**：外资连续增持，持股占比上升，中长期看好，建议关注

### 示例2：新进重仓

**输入**：个股B，2024-03-20收盘后
**数据**：
- 持股占比：5.2%（从4.8%上升，跨越5%阈值）
- 20日持股变化率：+65%
- 持股市值：28亿
- 行业：消费
**输出**：
- 信号：新进重仓（配置信号）
- **结论**：外资新进重仓，持股占比跨越5%，是重要配置信号，中长期看好

### 示例3：行业超配

**输入**：医药行业，2024-04-10收盘后
**数据**：
- 行业超配度：+4.5百分点
- 行业配置变化：+1.2百分点/月
- 行业持股占比：12%
- 行业涨跌幅：+3.5%（近月）
**输出**：
- 信号：行业超配度上升（行业轮动）
- **结论**：外资超配医药行业，配置持续增加，中期看好该行业

### 示例4：连续减持

**输入**：个股C，2024-05-15收盘后
**数据**：
- 连续减持天数：6天
- 10日持股变化率：-12%
- 持股占比：4.8%（从5.3%下降，跌破5%阈值）
- 持股市值：22亿
**输出**：
- 信号：连续减持 + 退出重仓（谨慎信号）
- **结论**：外资连续减持并退出重仓，持股占比跌破5%，短期谨慎
